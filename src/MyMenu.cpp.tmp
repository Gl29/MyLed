#include "MyMenu.h"






// Меню, первый пункт это не параметр, а просто выход с сохранением
MenuItem MenuItems[] = {
	{ "SAVE & EXIT     ", MenuSaveRam,		Null,		"      Press [+]" },
	{ "D01: Date Day   ", SettingDateDay,	DateDay,	"VAL: %02d" },
	{ "D02: Date Mount ", SettingDateMonth, DateMonth,	"VAL: %02d" },
	{ "D03: Date Year  ", SettingDateYear,	DateYear,	"VAL: 20%02d" },
	{ "D04: Time Hour  ", SettingTimeHour,	TimeHour,	"VAL: %02d" },
	{ "D05: Time Min   ", SettingTimeMin,	TimeMin,	"VAL: %02d" }
};


// Это переменные для работы меню
int	MenuCurent = 0; // Выбранный пункт меню
bool MenuEnter = false; // Мы находимся в меню?
int	MenuCount = 6; // Количество пунктов меню



// Обработка нажатия кнопки
void ButtonClick(int ButtonId) {

	if (MenuEnter) { // Если мы в меню
		if (ButtonId == 1) MenuEnter = false;	// Клик [Menu] Выход из меню 
		if (ButtonId == 2) MenuCurent--;		// Клик [Prev] Позицию ниже
		if (ButtonId == 3) MenuCurent++;		// Клик [Next] Позиция выше
		MenuCurent = constrain(MenuCurent, 0, MenuCount - 1);	// Ограничиваем меню
		if (ButtonId == 4) MenuItems[MenuCurent].on_click(1);	// Клик [+] Увеличиваем значение выбранного параметра 
		if (ButtonId == 5) MenuItems[MenuCurent].on_click(-1);	// Клик [-] Уменьшаем значение выбранного параметра 
	} else {
		if (ButtonId == 1)  MenuEnter = true; // Вход в меню
	}

	lcd.clear();
	lcd.setCursor(0, 0);
	lcd.print(MenuItems[MenuCurent].title); // Выводим заголовок
	lcd.setCursor(0, 1);
	sprintf(str_format, MenuItems[MenuCurent].format, MenuItems[MenuCurent].param); // Форматируем вывод знечения
	lcd.print(str_format); // Выводим значение

}

// Функции вызываемые для изменения значений переменных

void MenuSaveRam(int Concat) { // SAVE & EXIT
	if (Concat == 1) { //TODO Сохранение параметров в RAM };
	MenuEnter = false; // Выход из меню
}

void SettingDateDay(int Concat) {
	DateDay = constrain(DateDay + Concat, 1, 31); // Изменяем с ограничением
}

void SettingDateMonth(int Concat) {
	DateMonth = constrain(DateMonth + Concat, 1, 12);
}

void SettingDateYear(int Concat) {
	DateYear = constrain(DateYear + Concat, 0, 99);
}

void SettingTimeHour(int Concat) {
	TimeHour = constrain(TimeHour + Concat, 0, 23);
}

void SettingTimeMin(int Concat) {
	TimeMin = constrain(TimeMin + Concat, 0, 59);
}